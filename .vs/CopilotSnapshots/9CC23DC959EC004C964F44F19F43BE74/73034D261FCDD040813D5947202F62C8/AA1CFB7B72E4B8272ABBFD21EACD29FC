using System.Collections.Generic;
using System.IO;
using System.Text.Json;
using ExpenseManager.Models;

namespace ExpenseManager.Utils {
    public class CategoryHelper {
        private static readonly string categoriesFilePath = "Data/categories.json";

        public static List<string> GetDefaultCategories() {
            return new List<string> { "Ăn Uống", "Mua Sắm", "Giải Trí", "Khác" };
        }

        public static CategoryData LoadCategories() {
            if (File.Exists(categoriesFilePath)) {
                try {
                    string json = File.ReadAllText(categoriesFilePath);
                    return JsonSerializer.Deserialize<CategoryData>(json);
                } catch {
                    return CreateDefaultCategoryData();
                }
            }
            return CreateDefaultCategoryData();
        }

        public static void SaveCategories(CategoryData categoryData) {
            try {
                string json = JsonSerializer.Serialize(categoryData, new JsonSerializerOptions { WriteIndented = true });
                Directory.CreateDirectory(Path.GetDirectoryName(categoriesFilePath));
                File.WriteAllText(categoriesFilePath, json);
            } catch {
                // Handle save error silently
            }
        }

        private static CategoryData CreateDefaultCategoryData() {
            var categoryData = new CategoryData();
            categoryData.Categories = GetDefaultCategories();
            
            categoryData.CategoryKeywords["Ăn Uống"] = new List<string> { "ăn", "uống", "cơm", "cà phê", "trà", "nước" };
            categoryData.CategoryKeywords["Mua Sắm"] = new List<string> { "mua", "giày", "quần", "áo", "shopee", "tiki" };
            categoryData.CategoryKeywords["Giải Trí"] = new List<string> { "xem", "phim", "game", "hát", "nhạc" };
            categoryData.CategoryKeywords["Khác"] = new List<string> { };

            return categoryData;
        }
    }
}